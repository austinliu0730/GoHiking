@model List<GoHiking.ViewModels.ActivityViewModel>

@{
    ViewBag.Title = "我的活動";
}

@section MyCSS{
    <link href="~/css/mycss/product.css?v=@DateTime.Now.Ticks" rel="stylesheet" />
}

<div class="section py-5">
    <div class="container-fluid">
        <div class="row justify-content-center">
            <div class="col-10 col-xl-9">
                <div class="card p-4 shadow rounded main-card">
                    <div class="row">
                        <div class="col-lg-3 pr-lg-5">
                            <aside class="sidebar d-none d-lg-block">
                                <h3 class="sidebar-title">會員中心</h3>
                                <p class="sidebar-subtitle">Account</p>
                                <ul class="activity-list">
                                    <li class="active">
                                        <a href="/Team/Index" onclick="showEdit()">修改資料</a>
                                    </li>
                                    <li>
                                        <a href="/Team/Trip" onclick="showActivity()">我的活動</a>
                                    </li>
                                    <li>
                                        <a href="/User/Logout">登出</a>
                                    </li>
                                </ul>
                            </aside>
                        </div>

                        <div class="col-lg-9">
                            <div class="container">
                                <!-- 添加標題和說明 -->
                                <div class="row mb-4">
                                    <div class="col-12">
                                        <h2 class="mb-2">主辦的活動</h2>
                                        <p class="text-muted">共 @Model.Count 個活動</p>
                                        <hr />
                                    </div>
                                </div>


                                <!-- 檢查是否有活動 -->
                                @if (Model != null && Model.Any())
                                {
                                    <div class="row">
                                        @for (int i = 0; i < Model.Count; i++)
                                        {
                                            var activity = Model[i];
                                            var remainingSpots = activity.max_participants - activity.participants;
                                            <div class="col-6 col-lg-4 mb-4" data-aos="fade-up" data-aos-delay="@((i + 1) * 100)">
                                                <div class="media-entry">
                                                    <a href="@(Url.Action("Index", "TripHelper", new { id = activity.activity_id }))">

                                                        @if (activity.ImageData != null && activity.ImageData.Length > 0)
                                                        {
                                                            <img src="data:image/jpeg;base64,@Convert.ToBase64String(activity.ImageData)"
                                                                 alt="@activity.mt_name"
                                                                 style="width: 100%; height: 200px; object-fit: cover;"
                                                                 class="rounded-top">
                                                        }
                                                        else
                                                        {
                                                            <img src="https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=900&h=400&fit=crop&crop=center"
                                                                 alt="@activity.mt_name"
                                                                 style="width: 100%; height: 200px; object-fit: cover;"
                                                                 class="rounded-top">
                                                        }
                                                    </a>
                                                    <div class="bg-white m-body">
                                                        <span class="date">@activity.walk_days 天</span>
                                                        <h3>
                                                            <a href="@(Url.Action("Index", "TripHelper", new { id = activity.activity_id }))">
                                                                @activity.mt_name
                                                            </a>
                                                        </h3>

                                                        <div class="trail-info mb-2">
                                                            <small class="text-muted">
                                                                @* 審核狀態 *@
                                                                @if (activity.is_active == true)
                                                                {
                                                                    <span class="badge bg-success me-1">審核通過</span>
                                                                }
                                                                else
                                                                {
                                                                    <span class="badge bg-warning text-dark me-1">待審核</span>
                                                                }

                                                                @* 成團狀態 *@
                                                                @if (remainingSpots == 0)
                                                                {
                                                                    <span class="badge bg-primary me-1">即將成團</span>
                                                                }
                                                                else if (remainingSpots > 0)
                                                                {
                                                                    <span class="badge bg-info me-1">還差 @remainingSpots 人</span>
                                                                }

                                                                @* 其他徽章 *@
                                                                @if (!string.IsNullOrEmpty(activity.badge))
                                                                {
                                                                    <span class="badge bg-secondary">@activity.badge</span>
                                                                }
                                                            </small>
                                                        </div>

                                                        <div class="price-section mt-2 d-flex align-items-center">
                                                            <strong class="text-primary">NT$ @activity.price.ToString("N0")</strong>
                                                            <span class="mx-2">|</span>
                                                            <div class="difficulty-stars">
                                                                @for (int a = 1; a <= 5; a++)
                                                                {
                                                                    <span class="star @(a <= Math.Max(1, activity.diff) ? "" : "inactive")"></span>
                                                                }
                                                            </div>
                                                        </div>


                                                    </div>
                                                </div>
                                            </div>
                                        }
                                    </div>
                                }
                                else
                                {
                                    <!-- 無活動時的顯示 -->
                                    <div class="row">
                                        <div class="col-12 text-center py-5">
                                            <div class="mb-4">
                                                <i class="fas fa-mountain fa-4x text-muted"></i>
                                            </div>
                                            <h4 class="text-muted mb-3">還沒有開團活動</h4>
                                            <p class="text-muted mb-4">開始創建您的第一個登山活動吧！</p>
                                            <a href="@Url.Action("Create", "Team")" class="btn btn-primary">
                                                <i class="fas fa-plus me-2"></i>創建新活動
                                            </a>
                                        </div>
                                    </div>
                                }


                                <!-- 參與活動部分 -->
                                <div class="row mb-4">
                                    <div class="col-12">
                                        <h2 class="mb-2">參與的活動</h2>
                                        <p class="text-muted">共 @ViewBag.ParticipantActivities.Count 個活動</p>
                                        <hr />
                                    </div>
                                </div>

                                <!-- 檢查是否有參與活動 -->
                                @if (ViewBag.ParticipantActivities != null)
                                {
                                    <div class="row">
                                        @for (int i = 0; i < ViewBag.ParticipantActivities.Count; i++)
                                        {
                                            var activity = ViewBag.ParticipantActivities[i];
                                            var remainingSpots = activity.max_participants - activity.participants;
                                            <div class="col-6 col-lg-4 mb-4" data-aos="fade-up" data-aos-delay="@((i + 1) * 100)">
                                                <div class="media-entry">
                                                    <a href="@(Url.Action("Index", "TripHelper", new { id = activity.activity_id }))">

                                                        @if (activity.ImageData != null && activity.ImageData.Length > 0)
                                                        {
                                                            <img src="data:image/jpeg;base64,@Convert.ToBase64String(activity.ImageData)"
                                                                 alt="@activity.mt_name"
                                                                 style="width: 100%; height: 200px; object-fit: cover;"
                                                                 class="rounded-top">
                                                        }
                                                        else
                                                        {
                                                            <img src="https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=900&h=400&fit=crop&crop=center"
                                                                 alt="@activity.mt_name"
                                                                 style="width: 100%; height: 200px; object-fit: cover;"
                                                                 class="rounded-top">
                                                        }
                                                    </a>
                                                    <div class="bg-white m-body">
                                                        <span class="date">@activity.walk_days 天</span>
                                                        <h3>
                                                            <a href="@(Url.Action("Index", "TripHelper", new { id = activity.activity_id }))">
                                                                @activity.mt_name
                                                            </a>
                                                        </h3>

                                                        <div class="trail-info mb-2">
                                                            <small class="text-muted">
                                                                @* 參與者徽章 *@
                                                                <span class="badge bg-success me-1">已參與</span>

                                                                @* 審核狀態 *@
                                                                @if (activity.is_active == true)
                                                                {
                                                                    <span class="badge bg-success me-1">審核通過</span>
                                                                }
                                                                else
                                                                {
                                                                    <span class="badge bg-warning text-dark me-1">待審核</span>
                                                                }

                                                                @* 成團狀態 *@
                                                                @if (remainingSpots == 0)
                                                                {
                                                                    <span class="badge bg-primary me-1">即將成團</span>
                                                                }
                                                                else if (remainingSpots > 0)
                                                                {
                                                                    <span class="badge bg-info me-1">還差 @remainingSpots 人</span>
                                                                }

                                                                @* 其他徽章 *@
                                                                @if (!string.IsNullOrEmpty(activity.badge))
                                                                {
                                                                    <span class="badge bg-secondary">@activity.badge</span>
                                                                }
                                                            </small>
                                                        </div>

                                                        <div class="price-section mt-2 d-flex align-items-center">
                                                            <strong class="text-primary">NT$ @activity.price.ToString("N0")</strong>
                                                            <span class="mx-2">|</span>
                                                            <div class="difficulty-stars">
                                                                @for (int a = 1; a <= 5; a++)
                                                                {
                                                                    <span class="star @(a <= Math.Max(1, activity.diff) ? "" : "inactive")"></span>
                                                                }
                                                            </div>
                                                        </div>


                                                    </div>
                                                </div>
                                            </div>
                                        }
                                    </div>
                                }
                                else
                                {
                                    <!-- 無參與活動時的顯示 -->
                                    <div class="row">
                                        <div class="col-12 text-center py-5">
                                            <div class="mb-4">
                                                <i class="fas fa-users fa-4x text-muted"></i>
                                            </div>
                                            <h4 class="text-muted mb-3">還沒有參與任何活動</h4>
                                            <p class="text-muted mb-4">去看看有什麼有趣的登山活動吧！</p>
                                            <a href="@Url.Action("Index", "Home")" class="btn btn-success">
                                                <i class="fas fa-search me-2"></i>尋找活動
                                            </a>
                                        </div>
                                    </div>
                                }

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section HeroSection {
    <div class="img-bg rellax">
        <img src="/images/backgroup.jpg" alt="Image" class="img-fluid">
    </div>

    <div class="container">
        <div class="row align-items-center justify-content-center">
            <div class="col-lg-5 text-center">
                <p data-aos="fade-up" style="color:#FFFFFF; font-size:16px;">
                    台灣登山行程｜專業媒合團隊
                </p>
                <!-- 白色短線 -->
                <div style="width: 40px; height: 1px; background-color: #FFFFFF; margin: 1px auto;" data-aos="fade-up"></div>
            </div>
        </div>
    </div>
}

@section MyJS{
    <script src="~/Scripts/jquery-3.7.1.js"></script>
    <script>
        $(() => {
            $('.activity-list a').hover(function () {
                $('.activity-list li').removeClass('active');
                $(this).parent('li').addClass('active');
            });
        });
    </script>
}
