@model GoHiking.ViewModels.AdminDashboardViewModel
@{
    ViewBag.Title = "活動統計儀表板";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section MyCSS {
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
}

<style>
    .dashboard-card {
        background: white;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        padding: 20px;
        margin-bottom: 20px;
    }

    .stat-number {
        font-size: 2.5em;
        font-weight: bold;
        color: #2c5530;
    }

    .chart-container {
        position: relative;
        height: 400px;
        margin-bottom: 30px;
    }

    .map-container {
        height: 500px;
        border: 1px solid #ddd;
        border-radius: 5px;
    }

    .dashboard-header {
        text-center: true;
        margin-bottom: 30px;
    }

    .status-badge {
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 0.85em;
        font-weight: bold;
    }

    .status-recruiting {
        background: #fff3cd;
        color: #856404;
    }

    .status-almost-full {
        background: #cce5ff;
        color: #004085;
    }

    .status-completed {
        background: #d4edda;
        color: #155724;
    }

    .status-full {
        background: #f8d7da;
        color: #721c24;
    }

    .status-finished {
        background: #e2e3e5;
        color: #383d41;
    }

    .management-btn-card {
        background: white;
        border: 2px solid #e9ecef;
        border-radius: 12px;
        transition: all 0.3s ease;
        overflow: hidden;
    }

    .management-btn-card:hover {
        border-color: #17a2b8;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .btn-management {
        display: block;
        text-decoration: none;
        color: #495057;
        padding: 25px 20px;
        text-align: center;
        transition: all 0.3s ease;
        height: 100%;
    }

    .btn-management:hover {
        text-decoration: none;
        color: #17a2b8;
        background: linear-gradient(135deg, #f8f9fa, #e9ecef);
    }

    .btn-management.active {
        color: white;
        background: linear-gradient(135deg, #17a2b8, #20c997);
    }

    .btn-management.active:hover {
        color: white;
    }

    .btn-management i {
        font-size: 2.5em;
        margin-bottom: 15px;
        display: block;
    }

    .btn-management h5 {
        margin-bottom: 8px;
        font-weight: 600;
    }

    .btn-management p {
        font-size: 0.85em;
        line-height: 1.4;
    }

    .btn-management.active p {
        color: rgba(255,255,255,0.9);
    }
</style>

<div class="section py-5">
    <div class="container-fluid">
        <div class="row justify-content-center">
            <div class="col-12 col-xl-10">
                <div class="card p-4 shadow rounded" style="background: white;">
                    <!-- Dashboard Header -->
                    <div class="text-center mb-4 dashboard-header">
                        <div class="mb-3">
                            <i class="fas fa-chart-line fa-3x text-primary mb-3"></i>
                        </div>
                        <h2 class="heading mb-2" style="color: #2c3e50; font-weight: 600;">活動統計儀表板</h2>
                        <hr style="width: 60px; height: 3px; background: linear-gradient(45deg, #17a2b8, #20c997); border: none; margin: 20px auto;">
                        <p class="text-muted">GoHiking 登山活動管理系統數據分析</p>
                    </div>

                    <!-- 管理功能按鈕 -->
                    <div class="row mb-4">
                        <div class="col-md-3 mb-3">
                            <div class="management-btn-card h-100">
                                <a href="@Url.Action("Dashboard", "Admin")" class="btn-management active">
                                    <i class="fas fa-chart-bar"></i>
                                    <h5>統計儀表板</h5>
                                    <p class="text-muted mb-0">數據分析總覽</p>
                                </a>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="management-btn-card h-100">
                                <a href="@Url.Action("GroupManagement", "Admin")" class="btn-management">
                                    <i class="fas fa-users"></i>
                                    <h5>成團狀態</h5>
                                    <p class="text-muted mb-0">活動狀態管理</p>
                                </a>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="management-btn-card h-100">
                                <a href="@Url.Action("Index", "User")" class="btn-management">
                                    <i class="fas fa-user-cog"></i>
                                    <h5>人員管理</h5>
                                    <p class="text-muted mb-0">用戶帳號管理</p>
                                </a>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="management-btn-card h-100">
                                <a href="@Url.Action("Index", "Products")" class="btn-management">
                                    <i class="fas fa-clipboard-check"></i>
                                    <h5>審核開團</h5>
                                    <p class="text-muted mb-0">活動審核管理</p>
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- 統計卡片區域 -->
<div class="row">
    <div class="col-md-3">
        <div class="dashboard-card text-center">
            <i class="fas fa-mountain fa-2x text-success"></i>
            <div class="stat-number text-success">@Model.TotalActivities</div>
            <h5>總活動數量</h5>
        </div>
    </div>
    <div class="col-md-3">
        <div class="dashboard-card text-center">
            <i class="fas fa-calendar-check fa-2x text-primary"></i>
            <div class="stat-number text-primary">@Model.ActiveActivities</div>
            <h5>進行中活動</h5>
        </div>
    </div>
    <div class="col-md-3">
        <div class="dashboard-card text-center">
            <i class="fas fa-users fa-2x text-info"></i>
            <div class="stat-number text-info">@Model.TotalUsers</div>
            <h5>註冊用戶</h5>
        </div>
    </div>
    <div class="col-md-3">
        <div class="dashboard-card text-center">
            <i class="fas fa-user-friends fa-2x text-warning"></i>
            <div class="stat-number text-warning">@Model.TotalParticipants</div>
            <h5>參與人次</h5>
        </div>
    </div>
</div>

<!-- 圖表區域 -->
<div class="row">
    <!-- 難度等級分布餅圖 -->
    <div class="col-md-6">
        <div class="dashboard-card">
            <h4><i class="fas fa-chart-pie"></i> 難度等級分布</h4>
            <div class="chart-container">
                <canvas id="difficultyChart"></canvas>
            </div>
        </div>
    </div>

    <!-- 成團狀態統計 -->
    <div class="col-md-6">
        <div class="dashboard-card">
            <h4><i class="fas fa-chart-donut"></i> 成團狀態統計</h4>
            <div class="chart-container">
                <canvas id="statusChart"></canvas>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- 每月活動趨勢圖 -->
    <div class="col-md-12">
        <div class="dashboard-card">
            <h4><i class="fas fa-chart-line"></i> 每月活動數量趨勢</h4>
            <div class="chart-container">
                <canvas id="monthlyTrendChart"></canvas>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- 地區活動熱度 -->
    <div class="col-md-12">
        <div class="dashboard-card">
            <h4><i class="fas fa-map-marker-alt"></i> 地區活動熱度分布</h4>
            <div class="chart-container">
                <canvas id="regionChart"></canvas>
            </div>
        </div>
    </div>
</div>

                </div>
            </div>
        </div>
    </div>
</div>





@section MyJS{
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
$(document).ready(function() {
    console.log('Dashboard script loaded');
    console.log('Chart.js available:', typeof Chart !== 'undefined');
    // 初始化所有圖表
    initDifficultyChart();
    initStatusChart();
    initMonthlyTrendChart();
    initRegionChart();
});
        // 難度等級分布餅圖
function initDifficultyChart() {
    $.get('@Url.Action("GetDifficultyDistribution", "Admin")')
        .done(function(data) {
            console.log('Difficulty data:', data);
            if (!data || data.length === 0) {
                console.log('No difficulty data available');
                return;
            }
            const ctx = document.getElementById('difficultyChart').getContext('2d');
            new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: data.map(item => item.label),
                    datasets: [{
                        data: data.map(item => item.count),
                        backgroundColor: [
                            '#28a745', '#17a2b8', '#ffc107', '#fd7e14', '#dc3545'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        })
        .fail(function(jqXHR, textStatus, errorThrown) {
            console.error('Error loading difficulty chart:', textStatus, errorThrown);
        });
}

// 成團狀態統計圖
function initStatusChart() {
    $.get('@Url.Action("GetGroupStatus", "Admin")', function(data) {
        const ctx = document.getElementById('statusChart').getContext('2d');
        new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: data.map(item => item.status),
                datasets: [{
                    data: data.map(item => item.count),
                    backgroundColor: [
                        '#fff3cd', '#cce5ff', '#d4edda', '#f8d7da', '#e2e3e5'
                    ],
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                }
            }
        });
    });
}

// 每月活動趨勢圖
function initMonthlyTrendChart() {
    $.get('@Url.Action("GetMonthlyActivityTrend", "Admin")')
        .done(function(data) {
            console.log('Monthly trend data:', data);
            if (!data || data.length === 0) {
                console.log('No monthly trend data available');
                return;
            }
            const ctx = document.getElementById('monthlyTrendChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.map(item => item.date),
                    datasets: [{
                        label: '活動數量',
                        data: data.map(item => item.count),
                        borderColor: '#2c5530',
                        backgroundColor: 'rgba(44, 85, 48, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        })
        .fail(function(jqXHR, textStatus, errorThrown) {
            console.error('Error loading monthly trend chart:', textStatus, errorThrown);
        });
}

// 地區活動分布圖
function initRegionChart() {
    $.get('@Url.Action("GetRegionDistribution", "Admin")', function(data) {
        const ctx = document.getElementById('regionChart').getContext('2d');
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: data.map(item => item.region),
                datasets: [{
                    label: '活動數量',
                    data: data.map(item => item.count),
                    backgroundColor: 'rgba(44, 85, 48, 0.7)',
                    borderColor: '#2c5530',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            stepSize: 1
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });
    });
    }
    </script>
}



@section HeroSection {
    <div class="img-bg rellax ">
        <img src="~/images/legend.jpg" alt="Image" class="img-fluid">
    </div>
    <div class="container">
        <div class="row align-items-center justify-content-center">
            <div class="col-lg-5 text-center">
                <p data-aos="fade-up" style="color:#FFFFFF; font-size:18px;">
                    統計儀錶板，尊敬的管理者。
                </p>
                <!-- 白色短線 -->
                <div style="width: 40px; height: 1px; background-color: #FFFFFF; margin: 1px auto;" data-aos="fade-up"></div>
            </div>
        </div>
    </div>
}
