@model IEnumerable<GoHiking.data.UserProfile>

@{
    ViewBag.Title = "會員資料管理";
    var activeId = Model.FirstOrDefault().activity_id;
    var mountainName = Model.FirstOrDefault().User.TripActivities.FirstOrDefault(m => m.activity_id == activeId)?.mt_name;
}

@section MyCSS{
    <link href="~/css/mycss/product.css?v=@DateTime.Now.Ticks" rel="stylesheet" />

}

<div class="section py-5">
    <div class="container-fluid">
        <div class="row justify-content-center">
            <div class="col-10 col-xl-9">
                <div class="card p-4 shadow rounded main-card">
                    <div class="row">
                        <div class="col-lg-3 pr-lg-5">
                            <aside class="sidebar d-none d-lg-block">
                                <h3 class="sidebar-title">@mountainName 行程列表</h3>
                                <p class="sidebar-subtitle">Trip</p>
                                <ul class="activity-list">
                                    <li class="active">
                                        <a href="@Url.Action("Index", "TripHelper", new { id = Model.FirstOrDefault()?.activity_id })" onclick="showEdit()">參與成員</a>
                                    </li>
                                    <li>
                                        <a href="@Url.Action("Comment", "TripHelper", new { id = Model.FirstOrDefault()?.activity_id })" onclick="showEdit()">行程討論</a>
                                    </li>
                                    <li>
                                        <a href="@Url.Action("Gear", "TripHelper", new { id = Model.FirstOrDefault()?.activity_id })" onclick="showEdit()">裝備選擇</a>
                                    </li>
                                    <li>
                                        <a href="@Url.Action("CalendarIntegrated", "TripHelper", new { id = Model.FirstOrDefault()?.activity_id })">運動規劃</a>
                                    </li>
                                    <li>
                                        <a href="/User/Logout">登出</a>
                                    </li>
                                </ul>
                            </aside>
                        </div>

                        <div class="col-9 content-section">
                            @if (Model != null && Model.Any())
                            {
                                var creator = Model.FirstOrDefault(m => m.is_creator == true);
                                var participants = Model.Where(m => m.is_creator != true).ToList();
                                var userDetail = creator.User?.UserDetails?.FirstOrDefault(m => m.UserId == creator.UserId);



                                <!-- 主辦人區域 -->
                                if (creator != null)
                                {
                                    <div class="row align-items-start">
                                        <div class="col-lg-3">
                                            <h4 class="section-title">主辦人</h4>
                                            <a href="#" class="person">
                                                @if (userDetail?.ProfileImage != null)
                                                {
                                                    <img src="data:image/*;base64,@Convert.ToBase64String(userDetail.ProfileImage)"
                                                         alt="Image" class="img-fluid mb-4" />
                                                }
                                                else
                                                {
                                                    <img src="~/images/person_1.jpg" alt="Image" class="img-fluid mb-4" />
                                                }

                                                <span class="subheading d-inline-block">@(userDetail?.FullName ?? creator.RealName)</span>
                                                <h3 class="mb-3">@creator.Phone</h3>
                                                <p class="text-muted">@creator.ExerciseHabit</p>
                                            </a>
                                        </div>
                                        <div class="col-lg-6 offset-lg-1">
                                            <h4 class="section-title">主辦資訊</h4>
                                            <div class="organizer-info" style="padding-top: 30px;">
                                                <p><strong>LINE：</strong>@creator.LineId</p>
                                                <p><strong>登山經驗：</strong>@creator.HikingExperience</p>
                                                <p><strong>活動經驗：</strong>已舉辦 @ViewBag.ActivityCount 場活動</p>
                                                <p><strong>評價：</strong>★★★★☆</p>
                                            </div>
                                        </div>
                                    </div>
                                }

                                <!-- 分隔線 -->
                                <div class="divider mx-auto"></div>

                                <br />


                                <!-- 參與成員區域 -->
                                <h4 class="section-title">參與成員</h4>


                                if (participants.Any())
                                {
                                    <div class="row">
                                        @foreach (var member in participants)
                                        {
                                            <div class="col-lg-4">
                                                <a href="#" class="person">
                                                    @{
                                                        var memberDetail = member.User?.UserDetails?.FirstOrDefault(m => m.UserId == member.UserId);
                                                    }
                                                    @if (memberDetail?.ProfileImage != null)
                                                    {
                                                        <img src="data:image/*;base64,@Convert.ToBase64String(memberDetail.ProfileImage)"
                                                             alt="Image" class="img-fluid mb-4" />
                                                    }
                                                    else
                                                    {
                                                        <img src="~/images/person/people1.jpg" alt="Image" class="img-fluid mb-4" />
                                                    }
                                                    <div class="person-info">
                                                        <span class="subheading d-block mb-1">@member.RealName</span>
                                                        <h5 class="mb-2">@member.Phone</h5>
                                                        <p class="text-muted mb-0">@member.HikingExperience</p>
                                                    </div>
                                                </a>
                                            </div>
                                        }
                                    </div>
                                }
                                else
                                {
                                    <div class="text-center text-muted">
                                        <p>尚無參與成員</p>
                                    </div>
                                }
                            }
                            else
                            {
                                <div class="text-center text-muted py-5">
                                    <p>尚無成員資料</p>
                                </div>
                            }
                        </div>





                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section HeroSection {
    <div class="img-bg rellax">
        <img src="/images/backgroup.jpg" alt="Image" class="img-fluid">
    </div>

    <div class="container">
        <div class="row align-items-center justify-content-center">
            <div class="col-lg-5 text-center">
                <p data-aos="fade-up" style="color:#FFFFFF; font-size:16px;">
                    台灣登山行程｜專業媒合團隊
                </p>
                <!-- 白色短線 -->
                <div style="width: 40px; height: 1px; background-color: #FFFFFF; margin: 1px auto;" data-aos="fade-up"></div>
            </div>
        </div>
    </div>
}

@section MyJS{
    <script src="~/Scripts/jquery-3.7.1.js"></script>
    <script>
        $(() => {
            $('.activity-list a').hover(function () {
                $('.activity-list li').removeClass('active');
                $(this).parent('li').addClass('active');
            });
        });
    </script>
}